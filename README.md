---

# 高等UNIX程式設計 Advanced Programming in the UNIX Environment 

這個repo記錄了我在高U課程中所有實驗 (Lab) 和作業 (HW) 的學習過程與實作成果。這門課程深入探討了 Linux 系統程式設計的底層細節，並涵蓋了許多與系統安全、漏洞利用相關的重要概念。

---

## 課程核心技術與學習重點

在整個課程中，我接觸並實踐了以下關鍵技術與概念：

* **低階系統程式設計**：深入理解 Linux 核心介面、系統呼叫機制及其呼叫慣例。
* **組合語言 (x86-64)**：撰寫並理解底層機器碼，用於函式庫擴展、Shellcode 編寫與程式掛鉤。
* **記憶體管理與操作**：掌握虛擬記憶體、記憶體映射 (`mmap`)、堆疊佈局，以及讀寫程式記憶體的方法。
* **行程控制與除錯**：利用 `ptrace` 系統呼叫，實作程式載入、單步執行、斷點管理等除錯器核心功能。
* **函式庫與執行檔結構**：理解 ELF 檔案格式、動態連結、全域偏移表 (GOT)、程序連結表 (PLT) 等。
* **漏洞分析與利用**：識別並利用緩衝區溢位、競爭條件等程式漏洞，包括繞過 ASLR/PIE、Canary、NX 等保護機制。
* **Shellcoding 與 ROP**：編寫精簡的機器碼 (`Shellcode`) 來達成特定目的，以及使用返回導向程式設計 (ROP) 在不可執行記憶體區域中構造攻擊鏈。
* **併發與多執行緒程式設計**：分析多執行緒程式中可能出現的競爭危害與可重入性問題。
* **核心模組開發**：初步接觸 Linux 核心模組的編寫與核心 API 的使用。

---

## 實驗與作業內容回顧

### UP25 Lab01: 建構課程環境

* **目標**: 設定課程所需的開發與運行環境，熟悉 `docker`、`python` 和 `pwntools`。
* **重點**: 成功配置 Docker 環境、克隆課程倉庫、安裝 `pwntools` 並驗證其功能。實作 Python 腳本解決簡易 HTTP 挑戰，並編寫 `pwntools` 腳本與遠端挑戰伺服器互動，包含 PoW 解題及遊戲自動化。

### UP25 Lab02: 核心模組介紹與實作預備

* **目標**: 初步了解 Linux 核心模組的開發與實作。
* **重點**: 學習核心模組的基本結構、使用 `ioctl` 介面與使用者空間互動，並嘗試應用核心加密 API。準備 QEMU 模擬環境與交叉編譯工具，為實際核心模組開發做準備。

### UP25 Lab03: GOTOKU 挑戰 — `LD_PRELOAD` 與 GOT 表操作

* **目標**: 深入探討 `LD_PRELOAD` 和 GOT 表操作，並應用於解決 Sudoku 謎題。
* **重點**: 編寫共享物件作為解題器，利用 `LD_PRELOAD` 注入程式。學習在運行時動態修改 GOT 表，劫持對特定函式的呼叫，以控制程式行為。實作 Sudoku 解題邏輯，並結合 GOT 劫持自動化解題，同時處理 PoW 和遠端伺服器互動。

### UP25 HW1: 系統呼叫掛鉤與日誌記錄 (`zpoline`-inspired)

* **目標**: 實作一個受 `zpoline` 啟發的系統呼叫掛鉤機制，攔截並記錄 Linux 執行檔與檔案存取相關的系統呼叫。
* **重點**:
    * 透過 `LD_PRELOAD` 注入共享函式庫，並在虛擬記憶體位址 `0x0` 建立跳板。
    * 掃描程式碼區段，將 `syscall` 指令重寫為 `call *%rax`，實現系統呼叫的重新導向。
    * 撰寫組合語言跳板程式碼，處理暫存器保存與呼叫慣例轉換。
    * 利用獨立的連結器命名空間 (`dlmopen`) 避免無限遞迴。
* **挑戰**: 處理 x86-64 系統呼叫與 C 語言函式呼叫慣例的差異、精確的堆疊管理與對齊、避免跳板對返回值產生覆蓋、掃描記憶體區段時的段錯誤處理、以及將複雜組合語言邏輯模組化。

### UP25 Lab04: 組合語言實踐 — 擴展 `libmini`

* **目標**: 實踐 x86-64 組合語言程式設計，擴展自定義的 `libmini` 函式庫。
* **重點**: 使用 `yasm` 組合語言實作多個標準 C 函式，包括時間相關函式 (`time`, `srand`, `rand`)、信號集操作 (`sigemptyset` 等)、信號遮罩管理 (`sigprocmask`)，以及非局部跳轉函式 (`setjmp`, `longjmp`)。著重於底層暫存器操作、系統呼叫、堆疊管理和函式呼叫慣例。

### UP25 Lab05: 併發問題探索 — 競爭條件與可重入性

* **目標**: 調查多執行緒程式中可能存在的競爭條件 (Race Condition) 和可重入性 (Reentrancy) 問題。
* **重點**: 分析三個不同的挑戰伺服器原始碼，識別並利用程式中的併發相關漏洞，例如資料競爭、資源爭用等。撰寫 `pwntools` 腳本來自動化這些漏洞利用過程，以達成傾印檔案、擷取機密或讀取網頁內容的目標。

### UP25 Lab06: 緩衝區溢位與 Shellcoding 挑戰

* **目標**: 練習進階的組合語言技巧，實作緩衝區溢位攻擊和撰寫 Shellcode。
* **重點**: 挑戰包含多種類型的漏洞利用：
    * 在 `seccomp` 沙箱限制下撰寫並執行 Shellcode。
    * 利用無 Canary 保護的緩衝區溢位，注入並執行 Shellcode。
    * 繞過有 Canary 保護的緩衝區溢位（透過資訊洩露）。
    * 在有 NX 保護的環境下，利用 Return-Oriented Programming (ROP) 構造攻擊鏈。
* **挑戰**: 處理 ASLR/PIE 導致的位址隨機化（透過堆疊資訊洩露）、繞過堆疊 Canary 保護、以及在無法注入 Shellcode 時利用 ROP 鏈來實現攻擊目的。

### UP25 HW2: 簡易指令級除錯器 (`sdb`)

* **目標**: 實作一個簡易的 x86-64 指令級除錯器，類似於 GDB 的基礎功能。
* **重點**:
    * 使用 `ptrace` 系統呼叫追蹤並控制子行程。
    * 整合 Capstone 函式庫進行指令反組譯。
    * 實現程式載入、單步執行、繼續執行、斷點管理、暫存器檢視、記憶體修改及系統呼叫追蹤。
* **挑戰**: 精準定位動態連結和 PIE 程式的真實入口點、設計統一的斷點狀態管理機制以確保單步和繼續執行的正確性、處理非對齊記憶體位址的讀寫限制、以及動態更新記憶體映射以適應程式運行時的變化。

---